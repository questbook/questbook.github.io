<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Gasless Smart Contract Wallet Implementation | Questbook official blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="This implementation borrows from EIP 1776 and EIP 4337. However, simplified for a the use case of letting a dapp onboard a user to their platform without having to pay for the gas or install a wallet.
Assumptions The Dapp that wants to subsidize the gas for the user is a central entity, ie. the relayer. We&rsquo;re not decentralizing the relayer network as proposed in EIP 1613 User identification - OAuth A centralized relayer can subsidize the gas of the end user."><meta name=generator content="Hugo 0.107.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Gasless Smart Contract Wallet Implementation"><meta property="og:description" content="This implementation borrows from EIP 1776 and EIP 4337. However, simplified for a the use case of letting a dapp onboard a user to their platform without having to pay for the gas or install a wallet.
Assumptions The Dapp that wants to subsidize the gas for the user is a central entity, ie. the relayer. We&rsquo;re not decentralizing the relayer network as proposed in EIP 1613 User identification - OAuth A centralized relayer can subsidize the gas of the end user."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.questbook.xyz/posts/gasless-smart-contract-wallet-implementation/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-25T16:33:15+05:30"><meta property="article:modified_time" content="2022-05-25T16:33:15+05:30"><meta itemprop=name content="Gasless Smart Contract Wallet Implementation"><meta itemprop=description content="This implementation borrows from EIP 1776 and EIP 4337. However, simplified for a the use case of letting a dapp onboard a user to their platform without having to pay for the gas or install a wallet.
Assumptions The Dapp that wants to subsidize the gas for the user is a central entity, ie. the relayer. We&rsquo;re not decentralizing the relayer network as proposed in EIP 1613 User identification - OAuth A centralized relayer can subsidize the gas of the end user."><meta itemprop=datePublished content="2022-05-25T16:33:15+05:30"><meta itemprop=dateModified content="2022-05-25T16:33:15+05:30"><meta itemprop=wordCount content="549"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Gasless Smart Contract Wallet Implementation"><meta name=twitter:description content="This implementation borrows from EIP 1776 and EIP 4337. However, simplified for a the use case of letting a dapp onboard a user to their platform without having to pay for the gas or install a wallet.
Assumptions The Dapp that wants to subsidize the gas for the user is a central entity, ie. the relayer. We&rsquo;re not decentralizing the relayer network as proposed in EIP 1613 User identification - OAuth A centralized relayer can subsidize the gas of the end user."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Questbook official blog</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Gasless Smart Contract Wallet Implementation</h1><time class="f6 mv4 dib tracked" datetime=2022-05-25T16:33:15+05:30>May 25, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>This implementation borrows from <a href=https://eips.ethereum.org/EIPS/eip-1776>EIP 1776</a> and <a href=https://eips.ethereum.org/EIPS/eip-4337>EIP 4337</a>. However, simplified for a the use case of letting a dapp onboard a user to their platform without having to pay for the gas or install a wallet.</p><h1 id=assumptions>Assumptions</h1><ul><li>The Dapp that wants to subsidize the gas for the user is a central entity, ie. the relayer. We&rsquo;re not decentralizing the relayer network as proposed in <a href=https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1613.md>EIP 1613</a></li></ul><h1 id=user-identification---oauth>User identification - OAuth</h1><p>A centralized relayer can subsidize the gas of the end user. However, the centralized relayer may have it&rsquo;s own way to identify the user. This could be by asking the user to login using an Oauth.</p><p>All the transactions on chain transactions that will be executed by the user will be sent via the relayer. The frontend will also attach an access token.</p><pre tabindex=0><code>  axios.post(`https://relayer-url.com/relay`, { transactionData, accessToken });
</code></pre><p>The <code>/relay</code> endpoint may have custom logic to determine whether or not it wants to subsidise the said users&rsquo; gas.</p><h1 id=burnable-wallet>Burnable wallet</h1><p>When the user opens the app for the first time and provides OAuth access to the dapp, the user will be able to generate a wallet in browser. This will create a private key and store it in local storage.</p><pre tabindex=0><code>localStorage.set(&#39;pvtKey&#39;, web3.eth.accounts.create())
</code></pre><h1 id=smart-contract-wallet>Smart Contract Wallet</h1><p>Right after the burnable wallet is created, a smart contract wallet is deployed.
The default signatory of the smart contract wallet is the above created burnable wallet.</p><pre tabindex=0><code>  axios.post(&#39;https://relayer-url.com/new_wallet&#39;, { address, accessToken });
</code></pre><p>This smart contract wallet allows for</p><ul><li>Upgrading security, from burnable wallet to something more secure like browser wallet, hardware wallet, multisig.</li><li>Social recovery inbuilt even if user loses access to their signatory wallet, they can recover the wallet and just change the signatory</li></ul><pre tabindex=0><code>contract SmartContractWallet {
  address signatory;
  constructor(address _signatory){
    //...
  }

  function call(bytes calldata, bytes metaTxSignature) {
    require(isAllowed(calldata, metaTxSignature), &#34;Only signatory can use this wallet&#34;);
    call(calldata);
  }
  
  function call(bytes calldata) internal {
    //...
  }
  function changeSignatory(address newSignatory, bytes metaTxSignature) {
    require(isAllowed(bytes(newSignatory), metaTxSignature));
    //...
  }
  function addSocialRecoverer(address recoverer, bytes metaTxSignature) {
    //...
  }

  function recover(address newSignatory) {
    //...
    // if k/n recoverer call this function with the same newSignatory, change signatory
  }
}
</code></pre><h1 id=relayer>Relayer</h1><p>The relayer must take the <code>transactionData</code> on its <code>/relay</code> endpoint and execute the transaction onchain via the smart contract wallet.</p><pre tabindex=0><code>  getSmartContractWallet(address).call(calldata, signature);
</code></pre><p>It is completely upto the relayer to subsidise the gas or not. It can chose to reject relaying</p><h1 id=censorship-protection>Censorship protection</h1><p>The relayer architecture is just an optimization. Because the gas is subsidised and the transaction with external contracts happen via the smart contract wallet, the user may call the smart contract wallet&rsquo;s <code>call</code> function without the relayer and pay the gas from an EOA. That way, the relayer cannot stop any user from executing some transaction - it can only make it a little bit frustrating.</p><h1 id=universal>Universal</h1><p>This smart contract wallet can then be used to interact with any external smart contract. The external smart contracts need no change at all.</p><p>So that way, this smart contract wallet can become a user&rsquo;s primary smart contract wallet. All their credentials and soulbound NFTs that are rewarded to this address, can be used across the board.</p><p>I think this is going to be huge. Every user has a smart contract wallet. So their address on chain remains unaffected even when their primary wallet&rsquo;s private key is compromised.</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://blog.questbook.xyz/>&copy; Questbook official blog 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>